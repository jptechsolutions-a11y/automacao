<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ATUALIZADO: Título da Página -->
    <title>Atualização de Painéis - B.I.</title>
    <!-- Favicon e Meta (do seu modelo) -->
    <link rel="icon" href="fav.png" type="image/png"> 
    <meta name="theme-color" content="#011627">
    
    <!-- CSS (Novo arquivo) -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Tailwind (Apenas para utilitários, já que style.css é o principal) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Libs (do seu modelo) -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- ====================================================== -->
    <!-- <<< ESTILO ADICIONADO PARA O IFRAME DO LOOKER >>> -->
    <!-- ====================================================== -->
    <style>
        .looker-iframe {
            width: 100%;
            height: 100%;
            min-height: 80vh; /* Garante uma altura mínima */
        }

        /* --- Estilos das Sub-Abas (NOVO) --- */
        .imob-sub-nav {
            display: flex;
            border-bottom: 2px solid #e5e7eb; /* gray-200 */
        }
        .imob-sub-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1rem; /* 12px 16px */
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            background: none;
            cursor: pointer;
            color: #6b7280; /* gray-500 */
            border-bottom: 3px solid transparent;
            transform: translateY(2px); /* Alinha com a borda inferior */
            transition: all 0.2s ease;
        }
        .imob-sub-btn:hover {
            color: #1f2937; /* gray-800 */
            background-color: #f9fafb; /* gray-50 */
        }
        .imob-sub-btn.active {
            color: var(--accent); /* Cor principal do app */
            border-bottom-color: var(--accent);
        }
        .imob-sub-panel {
            display: none; /* Escondido por padrão */
        }
        .imob-sub-panel.active {
            display: block; /* Visível */
            animation: fadeIn 0.4s ease-out; /* Reutiliza a animação existente */
        }
        /* Ajuste para o painel do Looker preencher a tela */
        #imobSubPanel_Panel .info-card {
            height: 100vh; /* Altura total da viewport */
            max-height: calc(100vh - 200px); /* Ajuste para não estourar */
        }
    </style>
    <!-- ====================================================== -->

</head>
<body class="bg-gray-100">

    <div id="appShell" class="h-screen flex flex-col">

        <!-- Barra do Topo (Baseada no seu modelo) -->
        <header id="topBar" class="flex-shrink-0">
            <div class="flex items-center gap-4">
                <button id="sidebarToggle" class="btn-icon">
                    <i data-feather="menu" class="h-5 w-5"></i>
                </button>
                <!-- ATUALIZADO: Logo Placeholder -->
                <img src="https://placehold.co/100x40/011627/FFF?text=Pain%C3%A9is" class="h-8 w-auto" alt="Logo Painéis"> <!-- Placeholder para seu icon.png -->
                <div class="separator"></div>
                <div class="flex flex-col">
                    <span class="text-sm font-semibold text-white">Painel de B.I.</span>
                    <!-- ATUALIZADO: Subtítulo -->
                    <span class="text-xs text-gray-400">Automação de B.I.</span>
                </div>
            </div>
            
            <div class="flex-1 flex justify-center px-8">
                <!-- Espaço central -->
            </div>
            
            <div class="flex items-center gap-4">
                <!-- <div class="separator"></div> -->
                <!-- Ocultado o dropdown de perfil, pois não há login ainda -->
                <!-- Você pode re-adicionar depois -->
            </div>
        </header>

        <div id="mainSystem" class="flex flex-1 overflow-hidden">

            <!-- Sidebar (Menu de Navegação) -->
            <aside class="sidebar collapsed">
                <nav class="p-2 pt-4">
                    <a href="#home" class="nav-item" title="Home" onclick="window.GG.showView('homeView', this)">
                        <i data-feather="home" class="h-5 w-5 mr-3"></i> <span class="nav-text">Home</span>
                    </a>
                    <a href="#imob" class="nav-item" title="Upload Painel IMOB" onclick="window.GG.showView('imobView', this)">
                        <i data-feather="upload-cloud" class="h-5 w-5 mr-3"></i> <span class="nav-text">Upload IMOB</span>
                    </a>
                    
                    <!-- ====================================================== -->
                    <!-- <<< ATUALIZAÇÃO: Link "Painel IMOB (Looker)" REMOVIDO daqui >>> -->
                    <!-- ====================================================== -->
                    
                    <div class="mt-4 border-t border-gray-700 pt-2">
                        <span class="p-3 text-xs font-semibold text-gray-500 uppercase nav-text">Outros Painéis</span>
                    </div>
                    
                    <a href="#" class="nav-item disabled" title="Em breve">
                        <i data-feather="bar-chart-2" class="h-5 w-5 mr-3"></i> <span class="nav-text">Upload Vendas</span>
                    </a>
                    <!-- ====================================================== -->
                    <!-- <<< ADICIONADO: Exemplo de futuro painel de vendas >>> -->
                    <!-- ====================================================== -->
                    <a href="#lookerVendas" class="nav-item disabled" title="Em breve" onclick="window.GG.showView('lookerView', this, 'vendas')">
                        <i data-feather="dollar-sign" class="h-5 w-5 mr-3"></i> <span class="nav-text">Painel Vendas (Looker)</span>
                    </a>
                    <!-- ====================================================== -->
                    
                    <!-- ====================================================== -->
                    <!-- <<< ATUALIZAÇÃO: Habilitando o link de Configurações >>> -->
                    <!-- ====================================================== -->
                    <a href="#settings" class="nav-item" title="Configurações" onclick="window.GG.showView('settingsView', this)">
                        <i data-feather="settings" class="h-5 w-5 mr-3"></i> <span class="nav-text">Configurações</span>
                    </a>
                    <!-- ====================================================== -->
                    
                </nav>
            </aside>
            
            <div id="sidebarOverlay"></div>

            <!-- Conteúdo Principal (onde as "views" são trocadas) -->
            <main class="main-content">
                <div class="container mx-auto px-6 py-8">

                    <!-- 
                        View 1: Home (Nova) 
                        Tela de seleção de painéis
                    -->
                    <div id="homeView" class="view-content active">
                        <h1 class="text-2xl font-semibold text-gray-800 mb-6">Painéis de Atualização</h1>
                        
                        <div id="statusConexao" class="status-conexao mb-6">
                            <span id="textoStatus"><i data-feather="refresh-cw" class="animate-spin h-4 w-4 mr-2"></i> Verificando conexão com a API...</span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Card 1: Uploader IMOB (Ativo) -->
                            <div class="panel-card" onclick="window.GG.showView('imobView', document.querySelector('a[href=\'#imob\']'))">
                                <div class="panel-icon bg-blue-100 text-blue-600">
                                    <i data-feather="upload-cloud"></i>
                                </div>
                                <h3 class="panel-title">Upload Painel IMOB</h3>
                                <p class="panel-description">Atualizar a base de dados de movimentação (IMOB) colando dados do sistema.</p>
                                <span class="panel-status status-active">
                                    <i data-feather="check-circle" class="h-4 w-4"></i> Ativo
                                </span>
                            </div>

                            <!-- Card 2: Painel Vendas (Placeholder) -->
                            <div class="panel-card disabled">
                                <div class="panel-icon bg-gray-100 text-gray-400">
                                    <i data-feather="bar-chart-2"></i>
                                </div>
                                <h3 class="panel-title">Painel Vendas</h3>
                                <p class="panel-description">Atualizar relatórios de vendas consolidadas. (Em breve)</p>
                                <span class="panel-status status-inactive">
                                    <i data-feather="clock" class="h-4 w-4"></i> Em Criação
                                </span>
                            </div>

                            <!-- Card 3: Outro Painel (Placeholder) -->
                            <!-- ====================================================== -->
                            <!-- <<< ATUALIZAÇÃO: Card de Configurações agora é funcional >>> -->
                            <!-- ====================================================== -->
                            <div class="panel-card" onclick="window.GG.showView('settingsView', document.querySelector('a[href=\'#settings\']'))">
                                <div class="panel-icon bg-gray-100 text-gray-600">
                            <!-- ====================================================== -->
                                    <i data-feather="settings"></i>
                                </div>
                                <h3 class="panel-title">Configurações</h3>
                                <p class="panel-description">Gerenciar links de incorporação dos painéis do Looker Studio.</p>
                                <span class="panel-status status-active">
                                    <i data-feather="check-circle" class="h-4 w-4"></i> Ativo
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- 
                        View 2: Uploader IMOB (Refatorado)
                        Nosso uploader antigo, agora dentro da view.
                    -->
                    <div id="imobView" class="view-content">
                        
                        <h1 class="text-2xl font-semibold text-gray-800 mb-6">Upload em Lote - Painel IMOB</h1>
                        
                        <!-- ====================================================== -->
                        <!-- <<< ATUALIZAÇÃO: Adicionando Sub-Abas >>> -->
                        <!-- ====================================================== -->
                        <div class="imob-sub-nav mb-6">
                            <button id="imobSubTab_Update" class="imob-sub-btn active">
                                <i data-feather="upload" class="h-4 w-4 mr-2"></i> Atualizar Dados
                            </button>
                            <button id="imobSubTab_Panel" class="imob-sub-btn">
                                <i data-feather="trello" class="h-4 w-4 mr-2"></i> Visualizar Painel
                            </button>
                        </div>
                        <!-- ====================================================== -->

                        <!-- ====================================================== -->
                        <!-- <<< ATUALIZAÇÃO: Painel de Atualização >>> -->
                        <!-- (Todo o conteúdo de upload antigo vai aqui dentro) -->
                        <!-- ====================================================== -->
                        <div id="imobSubPanel_Update" class="imob-sub-panel active">
                            
                            <!-- ====================================================== -->
                            <!-- <<< CORREÇÃO: A ESTRUTURA ABAIXO HAVIA SIDO APAGADA >>> -->
                            <!-- ====================================================== -->

                            <!-- O wrapper do formulário (controla a exibição do sucesso) -->
                            <div id="imobUploaderForm" style="display: block;">
                                
                                <!-- Etapa 1: Filtros (RESTAURADO) -->
                                <div class="info-card mb-6">
                                    <h2 class="text-xl font-semibold mb-4 text-gray-700">1. Filtros de Inserção</h2>
                                    <p class="text-sm text-gray-600 mb-4">
                                        Preencha os valores que serão aplicados a todas as linhas novas.
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="filterEmpresa" class="block text-sm font-medium text-gray-600">Empresa (Filial)</label>
                                            <select id="filterEmpresa" class="form-input">
                                                <option value="">Carregando empresas...</option>
                                            </select>
                                            <p class="text-xs text-gray-500 mt-1">Selecione a Empresa/Filial.</p>
                                        </div>
                                        <div>
                                            <label for="filterProduto" class="block text-sm font-medium text-gray-600">Produto</label>
                                            <select id="filterProduto" class="form-input">
                                                <option value="">Carregando produtos...</option>
                                            </select>
                                            <p class="text-xs text-gray-500 mt-1">Selecione o produto a ser aplicado.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Etapa 2: Colar Dados (JÁ EXISTIA) -->
                                <div class="info-card mb-6">
                                    <h2 class="text-xl font-semibold mb-4 text-gray-700">2. Inserir Dados</h2>
                                    
                                    <!-- Navegação das Abas -->
                                    <div class="imob-tab-nav mb-4">
                                        <button id="imobPasteTab" class="imob-tab-btn active">
                                            <i data-feather="clipboard" class="h-4 w-4 mr-2"></i> Colar Dados
                                        </button>
                                        <button id="imobUploadTab" class="imob-tab-btn">
                                            <i data-feather="upload" class="h-4 w-4 mr-2"></i> Importar Arquivo
                                        </button>
                                    </div>

                                    <!-- Painel de Colar (Padrão) -->
                                    <div id="pastePanel" class="tab-panel active">
                                        <p class="text-sm text-gray-600 mb-4">
                                            Cole os dados copiados do seu sistema interno. (Sem cabeçalho).
                                        </p>
                                        <textarea id="dataInput" rows="10" class="form-input font-mono" placeholder="Cole os dados aqui..."></textarea>
                                    </div>

                                    <!-- Painel de Importar (Escondido) -->
                                    <div id="uploadPanel" class="tab-panel" style="display: none;">
                                        <p class="text-sm text-gray-600 mb-4">
                                            Para grandes volumes, faça o upload de um arquivo de texto (.txt, .csv, .tsv). O conteúdo será carregado na área de texto para processamento.
                                        </p>
                                        <input type="file" id="imobFileInput" class="form-input" accept=".txt,.csv,.tsv,.log">
                                        <p id="fileStatus" class="text-xs text-gray-500 mt-2"></p>
                                    </div>

                                    <!-- Botão de Processar (agora fora das abas) -->
                                    <button id="processButton" class="btn btn-primary w-full mt-6 disabled:opacity-50" disabled>
                                        <i data-feather="refresh-cw" class="h-4 w-4 mr-2"></i> Processar e Validar Dados
                                    </button>
                                </div>

                                <!-- Etapa 3: Prévia (RESTAURADO) -->
                                <div id="previewSection" class="info-card hidden">
                                    <h2 class="text-xl font-semibold mb-4 text-gray-700">3. Prévia dos Dados para Inserção</h2>
                                    <p id="previewSummary" class="text-sm text-gray-600 mb-4"></p>
                                    <div class="overflow-x-auto max-h-96 border border-gray-200 rounded-md">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr id="previewHeader"></tr>
                                            </thead>
                                            <tbody id="previewBody" class="bg-white divide-y divide-gray-200"></tbody>
                                        </table>
                                    </div>
                                    <button id="insertButton" class="btn btn-success w-full mt-6 disabled:opacity-50">
                                        <i data-feather="database" class="h-4 w-4 mr-2"></i> Confirmar e Inserir Linhas no Banco
                                    </button>
                                    <p id="insertStatus" class="text-sm text-center text-gray-500 mt-4"></p>
                                </div>
                            </div>

                            <!-- Tela de Sucesso (RESTAURADO) -->
                            <div id="imobSuccessScreen" class="success-animation-container" style="display: none;">
                                <div class="success-icon">
                                    <div class="circle"></div>
                                    <div class="checkmark"></div>
                                </div>
                                <h2 class="text-2xl font-semibold text-gray-800 mb-2">Inserção Concluída!</h2>
                                <p class="text-gray-600 mb-8">Os dados foram enviados com sucesso para o banco do B.I.</p>
                                
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <button id="imobSuccessAgainBtn" class="btn btn-secondary w-full sm:w-auto">
                                        <i data-feather="upload" class="h-4 w-4 mr-2"></i> Inserir Novo Lote
                                    </button>
                                    <button id="imobSuccessHomeBtn" class="btn btn-primary w-full sm:w-auto">
                                        <i data-feather="home" class="h-4 w-4 mr-2"></i> Voltar para Home
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ====================================================== -->
                            <!-- <<< FIM DA CORREÇÃO >>> -->
                            <!-- ====================================================== -->
                            
                        </div>
                        <!-- ====================================================== -->
                        <!-- <<< FIM DO PAINEL DE ATUALIZAÇÃO >>> -->
                        <!-- ====================================================== -->


                        <!-- ====================================================== -->
                        <!-- <<< ATUALIZAÇÃO: Painel de Visualização (Looker) >>> -->
                        <!-- ====================================================== -->
                        <div id="imobSubPanel_Panel" class="imob-sub-panel">
                            <div class="info-card p-0" style="overflow: hidden; height: 100vh;">
                                <iframe 
                                    id="imobLookerIframe"
                                    class="looker-iframe"
                                    src="" 
                                    frameborder="0"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                        <!-- ====================================================== -->
                        <!-- <<< FIM DO PAINEL DE VISUALIZAÇÃO >>> -->
                        <!-- ====================================================== -->


                    </div>

                    <!-- ====================================================== -->
                    <!-- <<< ATUALIZAÇÃO: Removido style="display: none;" >>> -->
                    <!-- ====================================================== -->
                    <!-- 
                        View 3: Looker Dashboard (NOVA) 
                        Tela para incorporar o painel do Looker.
                    -->
                    <div id="lookerView" class="view-content">
                        <h1 id="lookerTitle" class="text-2xl font-semibold text-gray-800 mb-6">Carregando Painel...</h1>
                        
                        <!-- 
                            O card abaixo usa p-0 (sem padding) e overflow-hidden 
                            para que o iframe ocupe todo o espaço.
                        -->
                        <div class="info-card p-0" style="overflow: hidden; height: 80vh;">
                            <!-- 
                                IMPORTANTE: 
                                Substitua a URL abaixo pela URL de 'Embed' (incorporação) 
                                pública ou assinada fornecida pelo seu painel do Looker.
                            -->
                            <iframe 
                                id="lookerIframe"
                                class="looker-iframe"
                                src="" 
                                frameborder="0"
                                allowfullscreen>
                            </iframe>
                        </div>
                    </div>

                    <!-- ====================================================== -->
                    <!-- <<< ATUALIZAÇÃO: Removido style="display: none;" >>> -->
                    <!-- ====================================================== -->
                    <!-- 
                        View 4: Configurações (NOVA) 
                        Tela para gerenciar os links do Looker
                    -->
                    <div id="settingsView" class="view-content">
                        <h1 class="text-2xl font-semibold text-gray-800 mb-6">Configurações dos Painéis</h1>
                        
                        <div id="settingsAlertContainer"></div>

                        <div class="info-card mb-6">
                            <h2 class="text-xl font-semibold mb-4 text-gray-700">Links de Incorporação (Looker Studio)</h2>
                            <p class="text-sm text-gray-600 mb-6">
                                Cole aqui a URL de incorporação (embed URL) de cada painel. Lembre-se de configurar o painel no Looker Studio como "Qualquer pessoa com o link pode ver".
                            </p>

                            <div class="form-group mb-6">
                                <label for="settingLinkImob" class="block text-sm font-medium text-gray-700 mb-2">Link do Painel IMOB</label>
                                <input type="url" id="settingLinkImob" class="form-input" placeholder="https://lookerstudio.google.com/embed/reporting/...">
                            </div>

                            <div class="form-group mb-6">
                                <label for="settingLinkVendas" class="block text-sm font-medium text-gray-700 mb-2">Link do Painel Vendas</label>
                                <input type="url" id="settingLinkVendas" class="form-input" placeholder="https://lookerstudio.google.com/embed/reporting/...">
                            </div>

                            <button id="saveSettingsBtn" class="btn btn-primary w-full sm:w-auto">
                                <i data-feather="save" class="h-4 w-4 mr-2"></i> Salvar Configurações
                            </button>
                        </div>
                    </div>
                    <!-- ====================================================== -->
                    <!-- <<< FIM DA ATUALIZAÇÃO >>> -->
                    <!-- ====================================================== -->

                </div>
            </main>
        </div>
    </div>
    
    <!-- Tela de Loading (do seu modelo) -->
    <div class="loading" id="loading" style="display: none;"><div class="spinner"></div><p>Processando...</p></div>

    <!-- Container de Notificações (do seu modelo) -->
    <div id="notificationContainer"></div>

    <!-- JS (Novo arquivo) -->
    <script src="app.js"></script>
    <script>
        // Inicializa os ícones do Feather
        feather.replace();
    </script>
</body>
</html>
